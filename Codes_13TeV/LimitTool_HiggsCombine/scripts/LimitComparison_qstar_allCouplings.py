#!/usr/bin/env python
import sys, os, subprocess, string, re
from ROOT import *
from array import array

gROOT.SetBatch(kTRUE);
gStyle.SetOptStat(0)
gStyle.SetOptTitle(0)
gStyle.SetTitleFont(42, "XYZ")
gStyle.SetTitleSize(0.045, "XYZ")
gStyle.SetLabelFont(42, "XYZ")
gStyle.SetLabelSize(0.045, "XYZ")
gStyle.SetCanvasBorderMode(0)
gStyle.SetFrameBorderMode(0)
gStyle.SetCanvasColor(kWhite)
gStyle.SetPadTickX(1)
gStyle.SetPadTickY(1)
t_m = 0.06  ##top margin
b_m = 0.11   ##botton margin
l_m = 0.115  ##left margin
r_m = 0.04  ##right margin
gStyle.SetPadTopMargin(t_m)
gStyle.SetPadBottomMargin(b_m)
gStyle.SetPadLeftMargin(l_m)
gStyle.SetPadRightMargin(r_m)
gROOT.ForceStyle()

masses_gev = array('d', [1000.0, 1050.0, 1100.0, 1150.0, 1200.0, 1250.0, 1300.0, 1350.0, 1400.0, 1450.0, 1500.0, 1550.0, 1600.0, 1650.0, 1700.0, 1750.0, 1800.0, 1850.0, 1900.0, 1950.0, 2000.0, 2050.0, 2100.0, 2150.0, 2200.0, 2250.0, 2300.0, 2350.0, 2400.0, 2450.0, 2500.0, 2550.0, 2600.0, 2650.0, 2700.0, 2750.0, 2800.0, 2850.0, 2900.0, 2950.0, 3000.0, 3050.0, 3100.0, 3150.0, 3200.0, 3250.0, 3300.0, 3350.0, 3400.0, 3450.0, 3500.0, 3550.0, 3600.0, 3650.0, 3700.0, 3750.0, 3800.0, 3850.0, 3900.0, 3950.0, 4000.0, 4050.0, 4100.0, 4150.0, 4200.0, 4250.0, 4300.0, 4350.0, 4400.0, 4450.0, 4500.0, 4550.0, 4600.0, 4650.0, 4700.0, 4750.0, 4800.0, 4850.0, 4900.0, 4950.0, 5000.0, 5050.0, 5100.0, 5150.0, 5200.0, 5250.0, 5300.0, 5350.0, 5400.0, 5450.0, 5500.0, 5550.0, 5600.0, 5650.0, 5700.0, 5750.0, 5800.0, 5850.0, 5900.0, 5950.0, 6000.0, 6050.0, 6100.0, 6150.0, 6200.0, 6250.0, 6300.0, 6350.0, 6400.0, 6450.0, 6500.0, 6550.0, 6600.0, 6650.0, 6700.0, 6750.0, 6800.0, 6850.0, 6900.0])

masses_tev = array('d', [ 0.001 * float(b) for b in masses_gev ])

xs_obs_limits_qstar_f1p0 = array('d', [0.022936930065301456, 0.01964698743190955, 0.02074974805594213, 0.01730817940970209, 0.011127689000504119, 0.00712534738701488, 0.006619120917647325, 0.007364515583718871, 0.006578060074436538, 0.004586958830057604, 0.00354957932828876, 0.00388654353590401, 0.004131931060981151, 0.003317319590811073, 0.0027551998991445356, 0.00277348312080054, 0.0030301345985531093, 0.0032543045928942493, 0.0033068571986234487, 0.0033714950444915094, 0.003474520697178718, 0.0035062150442692216, 0.0033141668022348657, 0.0028948942178921556, 0.0023898028787956408, 0.002081981419737184, 0.0020971912317776695, 0.002141412130906573, 0.0019194955730047944, 0.0014222886369670798, 0.0009129907603383323, 0.0006713609506387527, 0.000601631573239692, 0.000636081031446202, 0.0007101755382413364, 0.0007983844516313598, 0.0008710418897143124, 0.0009203885431488873, 0.0009608208293680115, 0.0010219787131155063, 0.0010699978390789728, 0.00108587113490241, 0.0010445906887351628, 0.0009763976043501929, 0.0008776765627386369, 0.0007509052701502667, 0.0006072405329490892, 0.0004771007691670018, 0.00038173057007165003, 0.0003129500892218255, 0.0002714186499819603, 0.00024398020645139865, 0.00023019926855488032, 0.0002229670463281343, 0.0002145528645014908, 0.0002039158327068621, 0.00018802635834689853, 0.00016778241492190676, 0.00015384780913186587, 0.0001389062281509322, 0.00013144812318674525, 0.00012994438022274636, 0.0001309833311192773, 0.0001341059010055712, 0.0001468127887161738, 0.00016240222978573714, 0.00018032139737033816, 0.0002024255978955625, 0.0002210638618296859, 0.00023330279693011872, 0.00024072642736631275, 0.00024109140677174023, 0.000234988301580714, 0.00023075952157021955, 0.00022246388971011879, 0.00020972862147974455, 0.00019773145222480806, 0.0001861119316722428, 0.00016752029274153966, 0.00014822190236680398, 0.00013409164019039164, 0.00012659754048150118, 0.00011987646567999737, 0.00011424614632974383, 0.00010610411922883671, 0.0001019909937005715, 9.87543664920265e-05, 9.625337209523421e-05, 9.441811633609126e-05, 9.409580054496892e-05, 9.23650427048779e-05, 9.078201341494988e-05, 8.925031654705646e-05, 8.770303399531565e-05, 8.640590699075183e-05, 8.548618237797218e-05, 8.469890855200794e-05, 8.390040251474624e-05, 8.33277925379604e-05, 8.26378092263897e-05, 7.939762498391869e-05, 7.953196771472606e-05, 7.942881995856976e-05, 7.934642311417554e-05, 7.93533010795054e-05, 7.935427145117691e-05, 7.944868393849716e-05, 7.94715025798254e-05, 7.960736526358443e-05, 7.967720012311683e-05, 7.973784069684147e-05, 7.988090098396929e-05, 8.271613349432888e-05, 8.310616303323439e-05, 8.347092762916592e-05, 8.388062981415747e-05, 8.431562254108347e-05, 8.496346429855665e-05, 8.571907273603616e-05])

xs_obs_limits_qstar_f0p5 = array('d', [0.01592397457194972, 0.014855116383721096, 0.017301017034627206, 0.014564928080546657, 0.009670849061089915, 0.00540626091449226, 0.005449784728270269, 0.006366042502005326, 0.00591488192990611, 0.0037384255684539355, 0.002766980096953565, 0.0032401463868563718, 0.003853634875831809, 0.002772963693566265, 0.0021703456759536587, 0.0022361099731188832, 0.0024499705886034547, 0.002657723435563734, 0.0026246972275038943, 0.0025736136566051533, 0.0027621875543728954, 0.002867453364281143, 0.0026895732179727174, 0.002335059244007366, 0.0018116003617527662, 0.0015100714524318476, 0.001637128533187208, 0.0019015393157589104, 0.0018167602106462562, 0.0012730553934543437, 0.0007264032060257203, 0.000497415367253351, 0.0004548914777850267, 0.0005019478313578462, 0.0005924191127722129, 0.0006774749001033242, 0.000718213647974128, 0.0007279187592577351, 0.0007420398886739443, 0.0007770574125984469, 0.0008277854614501056, 0.0008855255893579924, 0.0008976143346136166, 0.0008485493388331484, 0.0007595068852598218, 0.0006404960820493909, 0.0005111131975422716, 0.00039959943522885317, 0.00031530207733746027, 0.00025349224425584923, 0.0002163810150853841, 0.0002002640608766562, 0.00019569608769958658, 0.0001976902761917287, 0.0001978033324557256, 0.0001884302638596304, 0.00016910239141309992, 0.0001482899480696451, 0.00013080506563703284, 0.00011896469246174683, 0.00010797784532589434, 0.00010395367108444093, 0.00010317930274059832, 0.0001071016786789253, 0.00011913853021812145, 0.00013084372738610679, 0.00015196069807951631, 0.00017338292084900474, 0.0001962281418953465, 0.00021599836826490096, 0.00022631242637355145, 0.00022956587069899664, 0.00022341455342327694, 0.0002162112581556703, 0.00020667832058249958, 0.00019519989997961098, 0.00018042163812802297, 0.00016155717234413319, 0.00013935946960090076, 0.00012271648433013072, 0.00010838352615809184, 0.00010091300920229266, 9.590832340809374e-05, 9.357964279143112e-05, 9.03421285394068e-05, 8.773574696203934e-05, 8.526991700791874e-05, 8.325934937368506e-05, 7.916712238757776e-05, 7.812190173608452e-05, 7.899434205451909e-05, 7.814336963628359e-05, 7.63493395828712e-05, 7.374621696917916e-05, 7.289816133117346e-05, 7.210047977720308e-05, 7.132911256376005e-05, 7.2054353659399e-05, 7.153179362918783e-05, 7.11854035663978e-05, 7.080002656498662e-05, 7.050277427635487e-05, 7.043200745350581e-05, 7.035467809744244e-05, 7.008348369961126e-05, 6.996498125670454e-05, 6.967995984534614e-05, 6.941781064928686e-05, 6.922866525204011e-05, 6.909955589877701e-05, 6.890012816493227e-05, 6.880034284056477e-05, 6.585292761309558e-05, 6.57069900215029e-05, 6.556288455631506e-05, 6.544683166608325e-05, 6.546399300311269e-05, 6.550495898783616e-05, 6.558521134917246e-05])

xs_obs_limits_qstar_f0p1 = array('d', [0.014790098485113914, 0.012342743164221659, 0.015611104285853801, 0.01335192459854518, 0.008732549981974353, 0.004859686003007235, 0.005081012037489294, 0.006092064922593767, 0.005768763750407897, 0.0035600756703202717, 0.002563215387974563, 0.003052237687104011, 0.003771306422441887, 0.002580923567909724, 0.0019622896711295108, 0.002080393253041878, 0.0022695885863661712, 0.00247133498102695, 0.002436499015822637, 0.002319120892663158, 0.002488932812914866, 0.0025810511185986877, 0.0025087518003632037, 0.002162772770449546, 0.0016478653016091355, 0.0012971591072245873, 0.001505133522615545, 0.0018105616099232658, 0.0017576813309901124, 0.0012157886146436738, 0.0006588761648949184, 0.00044692634946624955, 0.000411160568799733, 0.00046302964354076907, 0.0005593226312188944, 0.0006353782397632209, 0.0006622878324282145, 0.0006631222982169355, 0.000671420187256879, 0.0007050330574789944, 0.0007629458175018041, 0.000824810520873373, 0.0008457827329938528, 0.0008055396349916902, 0.0007169806186046861, 0.0005993097144897066, 0.0004762293887599883, 0.00037336398853929213, 0.0002943895586823558, 0.00023557543273813118, 0.00020034847688058175, 0.00018313958258468316, 0.00018137434708907226, 0.00018953629129750852, 0.0001914404970245207, 0.00018029898621416213, 0.0001647337236797457, 0.00014132828747235972, 0.00012485854256309148, 0.00010882118143717684, 0.00010082060309744099, 9.659846891137353e-05, 9.566447470000458e-05, 9.884251254689041e-05, 0.00010686930325051945, 0.00012232209875507433, 0.0001373544284225812, 0.00015919971443632564, 0.00018093917098855626, 0.00020816671342891203, 0.0002238003145185398, 0.00022265949146392218, 0.00021801911077477533, 0.00021049802046602554, 0.0002003844289358324, 0.000188037549170987, 0.00017203175029751388, 0.00015089038436119748, 0.0001276678672307051, 0.00010900572763054516, 9.936309870238495e-05, 9.335464135693617e-05, 9.070664896630151e-05, 8.743392125579415e-05, 8.472976960428782e-05, 7.968641817100979e-05, 7.807603612647727e-05, 7.857551189134913e-05, 7.652382717457012e-05, 7.397656709438263e-05, 7.279964436153606e-05, 7.1774141783605e-05, 7.225932221592816e-05, 7.151976051708779e-05, 7.101346984097074e-05, 7.035514933783417e-05, 6.99089125145986e-05, 6.940803810971562e-05, 6.899988333121887e-05, 6.655777020044457e-05, 6.601434625263352e-05, 6.481670307725196e-05, 6.450845160856958e-05, 6.407558957451459e-05, 6.359543297080843e-05, 6.317556199538936e-05, 6.277304668834773e-05, 6.242497201783002e-05, 6.196981550422367e-05, 6.166043898955155e-05, 6.136003596857784e-05, 6.106466692801608e-05, 6.0772034084061345e-05, 6.0397359683154725e-05, 6.007610902868315e-05, 5.983375650541632e-05, 5.963299539498818e-05, 5.9468547267656127e-05, 5.9413620231477785e-05]) 

xs_obs_limits_qstar_f0p1_fb = array('d', [1000.0 * float(b) for b in xs_obs_limits_qstar_f0p1 ])
xs_obs_limits_qstar_f0p5_fb = array('d', [1000.0 * float(b) for b in xs_obs_limits_qstar_f0p5 ])
xs_obs_limits_qstar_f1p0_fb = array('d', [1000.0 * float(b) for b in xs_obs_limits_qstar_f1p0 ])

graph_obs_f1p0 = TGraph(len(masses_tev),masses_tev,xs_obs_limits_qstar_f1p0_fb)
graph_obs_f1p0.GetXaxis().SetTitle("Resonance Mass [TeV]")
graph_obs_f1p0.GetYaxis().SetTitle("#sigma #times B #times A #times #epsilon [fb]")
graph_obs_f1p0.GetYaxis().SetRangeUser(1e-2,1e+2)
graph_obs_f1p0.GetXaxis().SetNdivisions(510)
graph_obs_f1p0.GetXaxis().SetLimits(0.6,6.5)
graph_obs_f1p0.SetMarkerStyle(20)
graph_obs_f1p0.SetMarkerColor(2)
graph_obs_f1p0.SetLineWidth(2)
graph_obs_f1p0.SetLineStyle(1)
graph_obs_f1p0.SetLineColor(2)

graph_obs_f1p0.GetYaxis().CenterTitle()
graph_obs_f1p0.GetYaxis().SetLabelSize(0.04)
graph_obs_f1p0.GetYaxis().SetTitleOffset(1.1)
graph_obs_f1p0.GetXaxis().CenterTitle()
graph_obs_f1p0.GetXaxis().SetLabelSize(0.04)
graph_obs_f1p0.GetXaxis().SetTitleOffset(1.1)
graph_obs_f1p0.GetXaxis().CenterTitle()

graph_obs_f0p5 =TGraph(len(masses_tev),masses_tev,xs_obs_limits_qstar_f0p5_fb)
graph_obs_f0p5.SetMarkerStyle(24)
graph_obs_f0p5.SetMarkerColor(1)
graph_obs_f0p5.SetLineWidth(2)
graph_obs_f0p5.SetLineStyle(1)
graph_obs_f0p5.SetLineColor(1)

graph_obs_f0p1 =TGraph(len(masses_tev),masses_tev,xs_obs_limits_qstar_f0p1_fb)
graph_obs_f0p1.SetMarkerStyle(22)
graph_obs_f0p1.SetMarkerColor(4)
graph_obs_f0p1.SetLineWidth(2)
graph_obs_f0p1.SetLineStyle(1)
graph_obs_f0p1.SetLineColor(4)

c = TCanvas("c", "",800,800)
c.cd()

graph_obs_f1p0.Draw("ALP")
graph_obs_f0p5.Draw("LP")
graph_obs_f0p1.Draw("LP")

##legend = TLegend(.55,.69,.85,.92)  ## for pas twiki
legend = TLegend(.54,.54,.76,.75)
legend.SetBorderSize(0)
legend.SetFillColor(0)
legend.SetFillStyle(0)
legend.SetTextFont(42)
legend.SetTextSize(0.031)
legend.SetHeader('95% CL upper limits')
legend.AddEntry(graph_obs_f1p0,"Obs. lmt (f = 1.0)","lp")
legend.AddEntry(graph_obs_f0p5,"Obs. lmt (f = 0.5)","lp")
legend.AddEntry(graph_obs_f0p1,"Obs. lmt (f = 0.1)","lp")
legend.Draw()

lumiTextSize = 0.6
lumiTextOffset = 0.2
lumi = TLatex()
lumi.SetNDC()
lumi.SetTextAngle(0)
lumi.SetTextColor(kBlack)
lumi.SetTextFont(42)
lumi.SetTextAlign(31)
lumi.SetTextSize(lumiTextSize*t_m)
lumi.DrawLatex(1 - r_m, 1 - t_m +  lumiTextOffset*t_m, "35.9 fb^{-1} (13 TeV)")

cmsTextFont = 61
cmsTextSize = 0.75
extraTextFont = 52
extraOverCmsTextSize = 0.76
relExtraDY = 1.2
##posX_ = l_m     + 0.045 * (1 - l_m - r_m)  ##Top left
##posX_ = l_m     + 0.5   * (1 - l_m - r_m)   ## Centre
posX_ = 1 - r_m + 0.045 * (1 - l_m - r_m)  ## Top right
posY_ = 1 - t_m - 0.035 * (1 - t_m - b_m)

cms =  TLatex()
cms.SetNDC()
cms.SetTextFont(cmsTextFont)
cms.SetTextSize(cmsTextSize * t_m)
cms.SetTextAlign(33)  ### 11-top left;  21-top centre;  31-top right
##cms.DrawLatex(posX_, posY_, "CMS")
cms.DrawLatex(0.9, 0.92, "CMS")

### if extra text (Unpublished or Preliminary)
cms.SetTextFont(extraTextFont);
cms.SetTextAlign(33);
cms.SetTextSize(extraOverCmsTextSize*cmsTextSize*t_m);
##cms.DrawLatex(posX_, posY_- relExtraDY*cmsTextSize*t_m, extraText);
#cms.DrawLatex(0.9, 0.9 - relExtraDY*cmsTextSize*t_m, "Preliminary");

l1 = TLatex()
l1.SetNDC()
l1.SetTextAlign(13)
l1.SetTextFont(62)
l1.SetTextSize(0.04)
l1.SetTextFont(42)
l1.DrawLatex(0.78,0.85, "q*#rightarrow q#gamma") ##0.21,0.26


gPad.RedrawAxis();

c.SetLogy()
#c.SaveAs('LimitComp_bstar_1tagCategory_vs_0tagCategory_vs_CombineCategory.pdf')
#c.SaveAs('LimitComp_bstar_1tagCategory_vs_0tagCategory_vs_CombineCategory.png')

c.SaveAs('LimitComp_qstar_allCouplings.pdf')
c.SaveAs('LimitComp_qstar_allCouplings.png')


